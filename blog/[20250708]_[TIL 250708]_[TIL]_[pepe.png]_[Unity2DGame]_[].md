# 타일바니아 Tilevania

2D 플랫폼 게임 프로젝트 중 하나로 타일맵 기능을 활용해서 클래식한 사이드 스크롤 방식의 게임을 만드는 데 초점을 맞추고 있다.</br>

### 📌타일맵을 위한 이미지 자르기

#### Pixel Per Unit
설정된 픽셀이 하나의 유니티 단위에 상응함을 의미한다.</br>
값이 커질수록 더 많은 픽셀이 하나의 유니티 단위에 상응하기에 월드에서의 크기가 줄어든다.</br>

#### 아틀라스 이미지 자르기 ver1 (Automatic)
```
이미지 선택 -> Sprite Mode : Multiple 적용 -> "Open Sprite Editor" 클릭 -> Slice 탭 선택 (Type: Automatic, Pivot : Center) -> "Apply" 클릭
```

#### 아틀라스 이미지 자르기 ver2 (Grid By Cell Size)
```
ver1 과 동일... -> Slice 탭 선택 (Type: Grid By Cell Size, Pivot : Center) -> "Apply" 클릭
```
![slice_grid by cell size](img/post/250708/gridByCellSize.png)
![slice_grid by cell size](img/post/250708/gridByCellSize2.png)

### 📌 타일맵

#### Tilemap Pipeline
타일맵을 생성하는 순서는 아래와 같다.</br>
```plainText
Sprite Sheet -> Sliced Sprite -> Tile Asset -> Tile Palette -> Tilemap(Scene)
```
- Palette : 여러 개의 Tile 을 모아둔 도구창으로 타일을 선택하고 배치할 수 있는 공간
- Tile : Sprite 를 기반으로 만든 타일맵에 배치 가능한 오브젝트
- Sprite : 2D 그래픽 이미지로 타일맵에서 사용할 기본 이미지 조각

#### Tilemap, Tile Palette Asset 생성 & Tile Asset 배치하기
```plainText
1. 월드에 타일맵 생성하기
    Hierarchy 창 우클릭 -> 2D Object -> Tilemap -> Rectangular

2. Tile Palette 창 열기
    Window -> 2D -> Tile Palette -> Create New Tile Palette

3. Tile Asset 생성
    Sprite Sheet 에서 Slice 한 요소들을 팔레트에 드래그 앤 드롭하여 타일애셋을 생성한다.

4. 월드에 타일 애셋 배치하기
    Palette 에서 Paint with active brush(B) 를 선택하여 월드에 있는 타일맵에 배치하기
```
![tile palette](img/post/250708/tilePalette.png)
![tile asset](img/post/250708/tileAsset.png)
![tile asset result](img/post/250708/tileAssetResult.png)

#### 타일 애셋 편집하여 새로운 타일 애셋 생성하기
원하는 형태가 없다면 타일맵에 배치하여 수정할 수도 있지만, 팔레트에서 이미지를 수정하여 새로운 애셋을 생성할 수도 있다.</br>
![tile asset edit](img/post/250708/tileAssetEdit.png)

### 📌 레이어
배경 타일을 타일맵에 배치하고 싶을때 미리 배치해둔 발판을 배경 타일이 가리는 경우 레이어를 활용하여 이를 해결 할 수 있다.</br> 
![layer need](img/post/250708/layerNeed.png)

#### case 1) Order in Layer
Hierarchy 창에서 TileMap 객체를 선택하고 Inspector 에서 **Order in Layer** 의 값을 수정한다.</br>
<!-- 하지만, 이 방법은 레이어를 얼마나 추가할지 모르는 상태에선 적합한 방법이 아니다. -->

#### case 2) Add Layer
Hierarchy 창에서 Layer 를 추가해준다. (기본값은 Default)</br>
Add Layer 창에 들어가면 Layer 종류가 다양한데, 그 중 Sorting Layers 항목에 새로운 레이어를 추가해준다</br>
![sorting layers](img/post/250708/sortingLayers.png)
Tile map 애셋의 Inspector 창에서 Tilemap Renderer 의 Additional Settings/Sorting Layer 의 값을 수정해준다. 이후, Sorting Layers 에서 Layer 들의 순서를 조정해줌으로써 화면에서 어떤 Layer 가 앞에 그려져야하는지 설정해준다.</br>

### 📌 Unity Rule Tiles
어떤 타일을 어떤 칸에 배치할지 규칙을 사용하여 월드를 칠할 수 있다.
Rule Tiles 를 사용하기 위해선 **2D Tilemap Extras** 가 설치되어 있어야한다.</br>
![2d tilmap extras](img/post/250708/tilemapExtras.png)
```plainText
Project 창에서 우클릭 -> Create -> 2D -> Tiles -> Rule Tile 선택하여 생성
```
Rule Tile 을 월드에 배치하기 위해선 Tile Palette 에 추가해줘야한다.</br>
처음 Rule Tile 을 Tile Palette 에 추가하면 아무것도 보이지 않는데, 이는 Default Sprite 를 설정해주지 않아서 그렇다. Rule Tiled 의 Inspector 창에서 설정해주면된다.</br>
![tile rule result](img/post/250708/tileRuleResult.png)

### 📌Player Idle Animation
애니메이션 작업을 하기전에 Animator 창을 열어줘야한다.
```plainText
Window -> Animation -> Animator
```
애니메이션 시스템 항목
- Animator Component</br>
    GameObject 에 추가하는 Component 로 **Animator Controller 와 연결해서 실제로 애니메이션을 재생**하도록 해준다.</br>
    애니메이션을 어떻게 실행할지, 어떤 상태로 전활할지 등은 해당 컴포넌트가 담당한다.</br>
- Animator Controller</br>
    애니메이션 상태를 제어하는 그래프 에셋으로 **애니메이션의 흐름을 세밀하게 제어**할 수 있다.</br>
- Animation</br>
    실제로 재생되는 애니메이션 클립이다. 각 클립은 특정한 움직임(Idle, Walk, Run,...)을 표현한다.</br>
    런타임 기반으로 Transfer, Sprite, Material 등 다양한 속성의 변화를 담고 있다.</br>
- Sprite Renderer</br>
    2D 게임에서 스프라이트 이미지를 화면에 표시하는 컴포넌트다.</br>
    애니메이션을 재생할 때, **Animation Clip이 Sprite Renderer의 스프라이트 이미지를 프레임마다 바꿔주는 방식**으로 동작한다.</br>

#### Idle Animation 적용 과정
```plainText
1. GameObject 생성 및 Transform Rest, 이름 변경 (ex. Ginger = Player 이름)
2. Animator Component 추가
3. Animator Controller 생성 (우클릭 -> Create -> Animation -> Animator Controller)
4. Animation 생성 (Slice 된 Sprite 에서 Idle 에 해당하는 요소들 선택 -> 우클릭 -> Create -> Animation -> Animation Clip)
5. Animtor 창에 생성한 Idle Animation Clip 을 D&D 한 후, Entry -> Idle 방향으로 연결해준다.
6. Animation 창을 열고 (Windows -> Animation -> Animation) Idle Animation Clip 을 선택하여 생성된 애니메이션을 확인해본다.
7. Player 객체에 추가한 Animator Comp 에서 Controller 를 설정해준다. (3번에서 생성한 Animator Controller 로 설정)
8. 월드 화면에서 생성된 플레이어를 확인하기위해 Sprite Renderer Comp 를 Player 객체에 추가하고 기본 스프라이트를 Sprite 항목에 설정해준다.
9. Play 전에 Idle Animation Clip 의 Inspector 창에서 Loop Time 을 활성화해준다. 그러지 않으면 한번만 재생되고 멈춘다.
10. Play 시 월드에 배치된 플레이어 객체가 Idle 상태로 움직이는 걸 확인할 수 있다.
```
![player idle animation](img/post/250708/playerIdle.gif)

### 📌 애니메이션 상태(State) 전환
```plainText
1. 상태 전환용 애니메이션 클립을 생성한다 (Running)
2. 생성한 애니메이션 클립을 Animator 창에 D&D 한다.
3. 기존에 존재하고 있던 Idle 노드를 우클릭하고 Make Transition 을 선택하여 Running 노드와 연결한다.
4. 연결된 선을 클릭하면 Inspector 창에서 애니메이션 전환 관련 속성들을 확인할 수 있다.
    - Exit Time 0.7 -> 0
    - Transition Duration 0.25 -> 0
    - Exit Time true -> false
    Idle 상태에서 Running 상태로 방향키 입력시 바로 전환 되어야 하기에 전환에 걸리는 시간과 종료에 걸리는 시간들을 0으로 만들어준다. 또한, 단발성 애니메이션이 아니기에 Exit Time 도 false 로 변경해준다. 해당 값이 true 이면 애니메이션 종료시 원래 상태로 돌아가게된다.
5. Idle 과 Running 두 노드간 전환 트리거로 사용될 파라미터를 Animator 에 추가해준다. (bool isRunning)
6. 연결된 선을 다시 선택하여 Conditions 항목에 생성한 bool 변수를 추가해주고 값도 설정해준다.
    - Idle -> Running : isRunning = true
    - Running -> Idle : isRunning = false
7. Play 하여 Animator 의 Parameters 에서 생성한 bool 값을 변경해보며 애니메이션이 잘 동작하는지 확인한다.
```
![idle to running animation](img/post/250708/idleToRunning.gif)
![animator](img/post/250708/animator.png)

### 📌 프리팹(Prefab)
프리팹은 재사용 가능한 템플릿으로 변환된 게임 오브젝트를 의미한다.</br>
템플릿의 원본을 **프리팹**이라 부르며, 월드에 추가되는 복사본은 **인스턴스**라고 부른다.</br>
Hierarchy 창에 생성된 객체를 Project 창에 D&D 하면 Prefab 이 생성되며, Prefab 객체의 경우 아래의 그림과 같이 Hierarchy 창에서 표시되는 색상이 달라지고 확장자가 *.prefab 이 된다.</br>
![circle prefab](img/post/250708/prefab.png)
월드에 배치된 Prefab 의 Instance 의 Inspector 창의 상단을 보면 프래팹 열기,고르기,오버라이드 버튼이 존재한다.</br>
![prefab inspector](img/post/250708/prefabInspector.png)
만약 하나의 프리팹 인스턴스를 수정했고 해당 변경 사항을 모든 인스턴스에 적용하고자 한다면, 오버라이드에서 Apply All 을 선택해주면된다.</br>
또다른 방법은 프리팹 자체를 수정하는거다. 원본인 프리팹을 수정하면 수정 내용은 모든 인스턴스에 반영된다. 다만, 인스턴스에서 따로 수정한 영역에 대해서는 원본 프리팹의 수정 내용이 적용되지 않는다.</br>




