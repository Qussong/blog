# Stable Diffusion API í†µì‹ 

### ğŸ“ŒAPI í†µì‹  ì½”ë“œ (python ver)
#### ì½”ë“œ
```python
import requests
import base64

# ì„œë²„ ì£¼ì†Œ
url = 'http://127.0.0.1:7860/sdapi/v1/txt2img'

# í”„ë¡¬í”„íŠ¸ ì„¤ì •
payload = {
    "prompt": "a fluffy white cat lying on a wooden floor, natural sunlight from the window, photorealistic, ultra detailed, 8k, soft shadow, close-up",
    "negative_prompt": "low quality, blurry, deformed, bad anatomy, bad eyes, cross-eyed, asymmetrical eyes, mutated eyes, fused eyes, extra eyes, extra limbs, cropped, out of frame, watermark, text, nsfw, unnatural colors",
    "steps": 25,
    "cfg_scale": 7.5,
    "sampler_name": "DPM++ 2M",
    "scheduler": "Karras",
}

response = requests.post(url, json=payload)

# base64 ì´ë¯¸ì§€ ì¶”ì¶œ
r = response.json()
image_data = r['images'][0]

# íŒŒì¼ë¡œ ì €ì¥
with open("output.png", "wb") as f:
    f.write(base64.b64decode(image_data))
```
#### ê²°ê³¼ë¬¼
![ìŠ¤í…Œì´ë¸” ë””í“¨ì „ ê²°ê³¼ë¬¼](img/post/250704/output.png)

#### ì½”ë“œ ë¶„ì„
sd webui api ì— í…ìŠ¤íŠ¸ í”„ë¡¬í”„íŠ¸ë¥¼ POST ìš”ì²­í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ëŠ” ì½”ë“œë‹¤.</br>
ê²°ê³¼ ì´ë¯¸ì§€ë¥¼ base64ë¡œ ë°›ì•„ì™€ pngë¡œ ì €ì¥í•˜ë©° ì „ì²´ íë¦„ì„ ë‹´ê³  ìˆë‹¤.</br>
```plainText
1. ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„í¬íŠ¸
2. ìš”ì²­ URL ì„¤ì •
3. í”„ë¡¬í”„íŠ¸ì™€ ì„¤ì • íŒŒë¼ë¯¸í„° ì •ì˜
4. ì´ë¯¸ì§€ ìƒì„± ìš”ì²­ ì „ì†¡
5. ì‘ë‹µ ë°›ì•„ ì´ë¯¸ì§€ ì¶”ì¶œ ë° ë””ì½”ë”©
6. ì´ë¯¸ì§€ ì €ì¥
```
1. ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„í¬íŠ¸</br>
**request** : HTTP ìš”ì²­ì„ ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬</br> 
**base64** : ì‘ë‹µ ì´ë¯¸ì§€ê°€ ë¬¸ìì—´ í˜•ì‹ìœ¼ë¡œ ì „ë‹¬ë˜ë¯€ë¡œ ì´ë¥¼ ë””ì½”ë”©í•˜ê¸° ìœ„í•´ ì‚¬ìš©</br>
2. ìš”ì²­ URL ì„¤ì •</br>
SD webui ì—ì„œ ì œê³µí•˜ëŠ” REST API ì£¼ì†Œ</br>
```plainText
url = 'http://127.0.0.1:7860/sdapi/v1/txt2img'
```
3. í”„ë¡¬í”„íŠ¸ì™€ ì„¤ì • íŒŒë¼ë¯¸í„° ì •ì˜</br>
```python
payload = {
    "prompt": "...",              # ìƒì„±í•  ì´ë¯¸ì§€ì— ëŒ€í•œ ì„¤ëª…
    "negative_prompt": "...",     # í”¼í•˜ê³  ì‹¶ì€ ìš”ì†Œ
    "steps": 25,                  # ë””í“¨ì „ ë°˜ë³µ ìˆ˜ (ë” ë§ì„ìˆ˜ë¡ í’ˆì§ˆâ†‘, ì†ë„â†“)
    "cfg_scale": 7.5,             # í”„ë¡¬í”„íŠ¸ì— ëŒ€í•œ ì¶©ì‹¤ë„ (7~10 ê¶Œì¥)
    "sampler_name": "DPM++ 2M",   # ìƒ˜í”Œë§ ì•Œê³ ë¦¬ì¦˜
    "scheduler": "Karras"         # ìƒ˜í”Œë§ ìŠ¤ì¼€ì¤„ëŸ¬ (ë…¸ì´ì¦ˆ ë¶„í¬ ë°©ì‹)
}
```
4. ì´ë¯¸ì§€ ìƒì„± ìš”ì²­ ì „ì†¡</br>
POST ë°©ì‹ìœ¼ë¡œ API í˜¸ì¶œí•˜ê³  JSON í˜•ì‹ìœ¼ë¡œ í”„ë¡¬í”„íŠ¸ ë°ì´í„°ë¥¼ ì „ì†¡í•œë‹¤.</br>
```python
response = requests.post(url, json=payload)
```
5. ì‘ë‹µ ë°›ì•„ ì´ë¯¸ì§€ ì¶”ì¶œ ë° ë””ì½”ë”©</br>
ì‘ë‹µì€ JSON í˜•íƒœì´ë©° images í‚¤ ì•ˆì— base64 ë¬¸ìì—´ ì´ë¯¸ì§€ê°€ ë°°ì—´ë¡œ ë“¤ì–´ ìˆë‹¤.</br>
```python
r = response.json()
image_data = r['images'][0] # ì²« ë²ˆì§¸ ì´ë¯¸ì§€ ì„ íƒ
```
6. ì´ë¯¸ì§€ ì €ì¥</br>
base64 ë¬¸ìì—´ -> ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¡œ ë³€í™˜ í›„ output.png íŒŒì¼ë¡œ ì €ì¥</br>
```python
with open("output.png", "wb") as f:
    f.write(base64.b64decode(image_data))
```
